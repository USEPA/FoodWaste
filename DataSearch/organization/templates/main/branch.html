{% extends "base/site_base_organization.html" %}
{% block organization_content %}

<ol class="breadcrumb">
    <li><a href="{% url 'office_list' %}">EPA</a></li>
    <li><a href="{% url 'office_show' lab.office.id %}">{{lab.office.abbreviation}}</a></li>
    <li><a href="{% url 'lab_show' lab.id %}">{{lab.abbreviation}}</a></li>
    <li><a href="{% url 'division_show' division.id %}">{{division.abbreviation}}</a></li>
    {% if branch %}
    <li>{{branch.abbreviation}}</li>
    {% endif %}
</ol>
{% if branch %}
<h3>{{branch.abbreviation}} - {{branch.branch}}</h3>
{% else %}
<h3>Create branch</h3>
{% endif %}

{% if error_message %}<div class="alert alert-danger">{{error_message}}</div>{% endif %}

{% if success %}
    <div class="alert alert-success">
        The branch has been updated. <span class="glyphicon glyphicon-ok"></span>
    </div>
{% endif %}

{% if form.errors %}
<div class="alert alert-danger">
    <h5>Please correct the following errors</h5>
    {% for field in form %}
    {% if field.errors %}
    <div>{{field.label_tag}} {{ field.errors|striptags }}</div>
    {% endif %}
    {% endfor %}
</div>
{% endif %}

<form class="form-horizontal" method="post" action=".">
    {% csrf_token %}
    {% for field in form %}
    <div class="form-group">
        <label class="col-sm-2 control-label">
            <div>{{field.label_tag}}</div>
            <div class="help-block">{{field.help_text}}</div>
        </label>
        <div class="col-sm-10 {%if field.name == "is_active"%}checkbox{%endif%}">
            {{field}}
        </div>
    </div>
    {% endfor %}
    <div class="form-group">
        <div class="col-sm-2"></div>
        <div class="col-sm-10">
            {% if is_editing %}
            <button class="btn btn-success">Save</button>
            {% if branch %}
            <a class="btn btn-warning" href="{% url 'branch_show' branch.id %}">Undo changes</a>
            {% endif %}
            {% else %}
            <a class="btn btn-success" href="{% url 'branch_edit' branch.id %}">Edit</a>
            {% endif %}
        </div>
    </div>
</form>

<script>
$(document).ready(function(){
    {% if is_editing == True %}
    $('.jasc-user-select').asyncSelect({
        url: '/api/dropdown_users',
        displayValue:function(item){ return item.last_name + ", " + item.first_name + ' (' + item.email + ')' }
    })
    {% endif %}
})
</script>

{% endblock %}
