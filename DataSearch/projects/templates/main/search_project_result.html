{% extends "main/base.html" %}
{% load humanize %}

{% block content %}
<h3>Project Search Results</h3>

<div>

	<h4>Found {{the_count}} Projects ({{query_show}})</h4></p>
	<div><a href="{% url 'search_project' %}" class="btn btn-sm btn-link" role="button">New Search</a></div>
	<p>To refine your search, use your browser's back button.</p>
	{% if projects %}
    <table class="example table-autosort table-stripeclass:alternate table-autofilter" id="projects_table_{{grouper.id}}">
		<thead id="projects_head">
		<tr>
			<th class="table-sortable:alphanumeric">Project Lead</th>
			<th class="table-sortable:alphanumeric">Team Member(s)</th>
			<th class="table-sortable:alphanumeric">Project QA ID</th>
			<th class="table-sortable:alphanumeric">Previous ID</th>
			<th class="table-sortable:alphanumeric">Alternate ID</th>
			<th class="table-sortable:alphanumeric">QA Manager</th>
			<th class="table-sortable:date">Date Project Identified</th>
			<th class="table-header">Title</th>
			<th class="table-header">RAP Projects/Tasks</th>
			<th class="table-sortable:alphanumeric">QA Category</th>

			<th class="table-sortable:alphanumeric">QAPP Status</th>
			<th class="table-sortable:alphanumeric">Project Type</th>
			<th class="table-header">QA Activities</th>


		</tr>
		<tr>
			<th class="table-filterable"></th>
			<th class="table-header"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-header"></th>
			<th class="table-header"></th>
			<th class="table-filterable"></th>

			<th class="table-filterable"></th>

			<th class="table-header"></th>

	  	</tr>

		</thead>

		<tbody id="projects_body">

			{% for obj in projects %}
				<tr>
					<td>{% if obj.person %}<a href={% url 'activity_summary_user' obj.person.id %}>{{obj.person.last_name}}, {{obj.person.first_name}}</a>{% endif %}</td>
					<td>{% if obj.collaborators.all %}<table class="example table-stripeclass:alternate table-autofilter" id="cotlp_set_table">
							<thead id="cotlp_set_head">
								<tr>
								<th class="table-sortable:alphanumeric">Team Member(s)</th>
								</tr>
								<tr>
								<th class="table-filterable"></th>
								</tr>
							</thead>

							<tbody id="cotlp_set_body">

								{% for c in obj.collaborators.all %}
								<tr><td>{{c.last_name}}, {{c.first_name}}</a></td></tr>
								{% endfor %}

							</tbody>
							</table>{% endif %}</td>
					<td><a href={% url 'show_project' obj.id %}>{{obj.qa_id}}</a></td>
					<td>{{obj.previous_id}}</td>
					<td>{{obj.alt_id}}</td>
					<td>{% if obj.qa_manager %}<a href={% url 'activity_summary_user' obj.qa_manager.id %}>{{obj.qa_manager.last_name}}, {{obj.qa_manager.first_name}}</a>{% endif %}</td>
					<td>{{obj.date_project_identified|date:"Y-m-d"}}</td>
					<td width="200">{{obj.title}}</td>
          <td width="200">
              <div  style="text-align:left;padding:5px;">
                {% for row in obj.rap %}
                  <div style="padding-bottom:10px;">
                    {{row.values}}
                  </div>
                {% endfor %}
              </div>
          </td>
					<td>{% if obj.qa_category %}{{obj.qa_category.the_name}}{% endif %}</td>
					<td>{% if obj.qapp_status %}{{obj.qapp_status.the_name}}{% endif %}</td>
					<td>{% if obj.nrmrl_qapp_requirement.all %}<table class="example table-stripeclass:alternate table-autofilter" id="cotlp_set_table">
							<thead id="cotlp_set_head">
								<tr>
								<th class="table-sortable:alphanumeric">Project Type</th>
								</tr>
								<tr>
								<th class="table-filterable"></th>
								</tr>
							</thead>

							<tbody id="cotlp_set_body">

								{% for c in obj.nrmrl_qapp_requirement.all %}
								<tr><td>{{c.the_name}}</td></tr>
								{% endfor %}

							</tbody>
							</table>{% endif %}</td>

					<td><table class="example table-stripeclass:alternate table-autofilter" id="projectlog_set_table">
							<thead id="projectlog_set_head">
								<tr>
								<th class="table-sortable:alphanumeric">
                  QA Activity Number<br>Date Approved</th>
								</tr>
								<tr>
								<th class="table-filterable"></th>
								</tr>
							</thead>

							<tbody id="projectlog_set_body">

								{% for qlog in obj.projectlog_set.all %}
								<tr><td><a href={% url 'show_project_log' qlog.id %}>{{qlog.qa_log_number}}</a><br>{{qlog.date_approved|date:"Y-m-d"}}</td></tr>
								{% endfor %}

							</tbody>
							</table></td>
				</tr>
			{% endfor %}
			</tbody>
	</table>
{% endif %}
</div>

<script>
    $(document).ready(
                function() {
                     $("#id_lab").change(function() {
                             if ($(this).val() == '') {
                                 $("#division").html("<option>All Divisions</option>");
                             }
                             else {
                                 var url = "/projects/ajax/divisions/" + $(this).val() + "/ajax_lookup_divisions";
                                 var lab = $(this).val();
                                 $.getJSON(url, function(divisions) {
                                     var options = '<option value="">All Divisions</option>';
                                     for (var i = 0; i < divisions.length; i++) {
                                        options += '<option value="' + divisions[i].fields['abbreviation'] + '">' + divisions[i].fields['abbreviation'] + '</option>';
                                     }
                                     $("#division").html(options);
                                     $("#division").attr('disabled', false);
                                 });
                             }
                         });


    });

</script>
<script>
    $(document).ready(
                function() {
                     $("#division").change(function() {
                             if ($(this).val() == '') {
                                 $("#id_branch").html("<option>All Branches</option>");
                             }
                             else {
                                 var url = "/projects/ajax/branches/" + $(this).val() + "/ajax_lookup_branches";
                                 var division = $(this).val();
                                 $.getJSON(url, function(branches) {
                                     var options = '<option value="">All Branches</option>';
                                     for (var i = 0; i < branches.length; i++) {
                                        options += '<option value="' + branches[i].fields['abbreviation'] + '">' + branches[i].fields['abbreviation'] + '</option>';
                                     }
                                     $("#id_branch").html(options);
                                     $("#id_branch").attr('disabled', false);
                                 });
                             }
                         });



    });

</script>
{% endblock %}
