{% extends "main/base.html" %}
{% load humanize %}

{% block content %}
<h3>Projects with Separated Project Lead</h3>

<div>

	<h4>Found {{the_count}} Projects with Separated Project Lead Only ({{query_show}})</h4></p>
	<div><a href="{% url 'search_project' %}" class="btn btn-sm btn-link" role="button">New Search</a></div>
	<p>To refine your search, use your browser's back button.</p>
	{% if projects %}
    <table class="example table-autosort table-stripeclass:alternate table-autofilter" id="projects_table_{{grouper.id}}">
		<thead id="projects_head">
		<tr>
			<th class="table-sortable:alphanumeric">Project QA ID</th>
			<th class="table-header">Title</th>
			<th class="table-header">RAP Projects/Task</th>
			<th class="table-sortable:alphanumeric">Project Lead</th>
			<th class="table-sortable:date">Project Lead Separation Date</th>
			<th class="table-sortable:alphanumeric">QA Manager</th>
			<th class="table-sortable:alphanumeric">Project Status</th>
		</tr>
		<tr>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
			<th class="table-filterable"></th>
	  	</tr>

		</thead>

		<tbody id="projects_body">

			{% for obj in projects %}
				<tr>
					<td><a href={% url 'show_project' obj.id %}>{{obj.qa_id}}</a></td>
					<td width="200">{{obj.title}}</td>

					<td width="200">
						  <div  style="text-align:left;padding:5px;">
							{% for row in obj.rap %}
							  <div style="padding-bottom:10px;">
								{{row.values}}
							  </div>
							{% endfor %}
						  </div>
					  </td>

					<td>{% if obj.person %}<a href={% url 'activity_summary_user' obj.person.id %}>{{obj.person.last_name}}, {{obj.person.first_name}}</a>{% endif %}</td>
					<td>{{obj.person.userprofile.date_epa_separation|date:"Y-m-d"}}</td>

					<td>{% if obj.qa_manager %}<a href={% url 'activity_summary_user' obj.qa_manager.id %}>{{obj.qa_manager.last_name}}, {{obj.qa_manager.first_name}}</a>{% endif %}</td>

					<td>{% if obj.project_status %}{{obj.project_status.the_name}}{% endif %}</td>
				</tr>
			{% endfor %}
			</tbody>
	</table>
{% endif %}
</div>

<script>
    $(document).ready(
                function() {
                     $("#id_lab").change(function() {
                             if ($(this).val() == '') {
                                 $("#division").html("<option>All Divisions</option>");
                             }
                             else {
                                 var url = "/projects/ajax/divisions/" + $(this).val() + "/ajax_lookup_divisions";
                                 var lab = $(this).val();
                                 $.getJSON(url, function(divisions) {
                                     var options = '<option value="">All Divisions</option>';
                                     for (var i = 0; i < divisions.length; i++) {
                                        options += '<option value="' + divisions[i].fields['abbreviation'] + '">' + divisions[i].fields['abbreviation'] + '</option>';
                                     }
                                     $("#division").html(options);
                                     $("#division").attr('disabled', false);
                                 });
                             }
                         });


    });

</script>
<script>
    $(document).ready(
                function() {
                     $("#division").change(function() {
                             if ($(this).val() == '') {
                                 $("#id_branch").html("<option>All Branches</option>");
                             }
                             else {
                                 var url = "/projects/ajax/branches/" + $(this).val() + "/ajax_lookup_branches";
                                 var division = $(this).val();
                                 $.getJSON(url, function(branches) {
                                     var options = '<option value="">All Branches</option>';
                                     for (var i = 0; i < branches.length; i++) {
                                        options += '<option value="' + branches[i].fields['abbreviation'] + '">' + branches[i].fields['abbreviation'] + '</option>';
                                     }
                                     $("#id_branch").html(options);
                                     $("#id_branch").attr('disabled', false);
                                 });
                             }
                         });



    });

</script>
{% endblock %}
