{% extends "base/site_base_nb_tab.html" %}
{% load staticfiles %}

{% block nb_tab_content %}
<h3>Edit Notebook  {{obj.nb_number}}</h3>

<br>
<form class="form-horizontal" enctype="multipart/form-data" method="post" action="." role="form" novalidate autocomplete="off">

    {% csrf_token %}

    {% if form.errors %}

    <div class="alert alert-danger">
        <h5>Please correct the following errors</h5>
        {% for field in form %}
        {% if field.errors %}
        <div>{{field.label_tag}} {{ field.errors|striptags }}</div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <div class="form-group">
        <label class="col-sm-4 control-label">
            <div>Lead Organization</div>
        </label>
        <div class="col-sm-8"><br></div>
    </div>
    {% include 'organization_select.html' %}

    <p><br></p>

    {# LEAVE OUT LEAD ORG AND DISCIPLINE AS THAT'S HANDLED ABOVE #}
    {% for field in form %}
    {% if field.name != 'office' and field.name != 'lab' and field.name != 'division' and field.name != 'branch' %}
    <div class="form-group">
        <label class="col-sm-4 control-label">
            {% if field.help_text %}
            <div title="{{field.help_text}}">[?] {{field.label_tag}}</div>
            {% else %}
            <div>{{field.label_tag}}</div>
            {% endif %}
        </label>
        <div class="col-sm-8">
            {{field}}
            {% if field.errors %}<div class="alert alert-danger">{{field.errors.as_text}}</div>{% endif %}
        </div>
    </div>
    {% endif %}
    {% endfor %}

    <p>
      <h3 title="This table displays a log of each time any of the following fields are updated: Notebook Custodian, QA Manager, Status; or if the user enters a comment for the Update History.">Update History [?]</h3>
      </p>


  <table class="example table-autosort:7 table-stripeclass:alternate table-autofilter" id="nbtab_approval_history_table">
      <thead id="nbtab_approval_history_head">
      <tr>
        {#<th class="table-header">Date of Last Review</th>#}
          <th class="table-header">Notebook Custodian</th>
          <th class="table-header">QA Manager</th>
          <th class="table-header">Status</th>
          {# <th class="table-header">Review Status</th> #}
          <th class="table-header">Comment</th>
          <th class="table-header">Updated By</th>
          <th class="table-header">Date Updated</th>
      </tr>
      </thead>

      <tbody id="nbtab_approval_history_body">

      {% for obj in nb_approval_history %}
      <tr>
        {#<td>{{obj.date_reviewed|date:"Y-m-d"}}</td>#}
          <td>{{obj.custodian.last_name}}, {{obj.custodian.first_name}}</td>
          <td>{{obj.qa_manager.last_name}}, {{obj.qa_manager.first_name}}</td>
          <td>{{obj.status.the_name}}</td>
          {#<td>{{obj.nb_status.the_name}}</td>#}
          <td style="text-align: left">{{obj.comments}}</td>
          {% if obj.user %}
          <td>{{obj.user.last_name}}, {{obj.user.first_name}}</td>
          {% else %}
          <td>QA Track</td>
          {% endif %}
          <td>{{obj.created|date:"Y-m-d"}}</td>

      </tr>
      {% endfor %}
      </tbody>
  </table>

    <p><br></p>

<p title="If you do not enter a comment here, an entry will only be created for the Update History if the Notebook Custodian, QA Manager, or Status has changed.">
    Enter an optional comment for the Update History, and then click the "Update" button. [?]
</p>
    <div class="form-group">
        <div class="col-sm-8">
            <input class="form-control" type="text" name="update_comment">
        </div>
        <div class="col-sm-4">
            <input type="submit" value="Update" class="btn btn-success">
        </div>

    </div>

</form>

<script>
$(document).ready(function(){
    $('.jasc-project-select').asyncSelect({
        url: '/api/projects',
        displayValue: function(item){return item.qa_id + ": " + item.title}
    })

    $('.jasc-program-select').asyncSelect({
        url: '/api/programs',
        displayValue:'the_name'
    })

    $('.jasc-org-select').asyncSelect({
        url: '/api/participating_orgs',
        displayValue:'company'
    })

    $('.jasc-user-select').asyncSelect({
        url: '/api/dropdown_users',
        displayValue:function(item){ return item.last_name + ", " + item.first_name + ' (' + item.email + ')' }
    })

$(".date-control").datepicker({ dateFormat: "yy-mm-dd" });
})
</script>

{% endblock %}
