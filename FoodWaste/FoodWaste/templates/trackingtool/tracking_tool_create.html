{% extends "main/base.html" %}

{% block content %}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <form action="/trackingtool/create/" method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="" class="col-sm-3 control-label">{{form.work.label}}</label>
                    <div class="col-sm-9">{{form.work}}</div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-3 control-label">{{form.email.label}}</label>
                    <div class="col-sm-9">{{form.email}}</div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-3 control-label">{{form.phone.label}}</label>
                    <div class="col-sm-9">{{form.phone}}</div>
                </div>

                <div class="form-group">
                    <label for="searchMethodSelect" class="col-sm-3 control-label">Internet/Intranet Search Method</label>
                    <div class="col-sm-9">
                        <select id="searchMethodSelect" class="form-control">
                            <option value="google">Google Scholar</option>
                            <option value="duck">DuckDuckGo</option>
                            <option value="custom">Custom URL</option>
                        </select>
                    </div>
                </div>
                <div class="form-group col-sm-12 mt-2">
                    <label for="" class="col-sm-3 control-label">{{form.search.label}}</label>
                    <div class="col-sm-9">
                        <div class="col-sm-11">{{form.search}}</div>
                        <a id="searchLink" class="col-sm-1 btn btn-md btn-secondary disabled">Search</a>
                    </div>
                </div>

                <div class="form-group col-sm-12 hidden-div" style="display: none;">
                    <label for="" class="col-sm-3 control-label">{{form.article_title.label}}</label>
                    <div class="col-sm-9">{{form.article_title}}</div>
                </div>
                <div class="form-group col-sm-12 hidden-div" style="display: none;">
                    <label for="" class="col-sm-3 control-label">{{form.citation.label}}</label>
                    <div class="col-sm-9">{{form.citation}}</div>
                </div>


                <div class="form-group col-sm-12 hidden-div" style="display: none;">
                    <label for="" class="col-sm-3 control-label">{{form.comments.label}}</label>
                    <div class="col-sm-9">{{form.comments}}</div>
                </div>
                <div class="col-md-12">
                    <button type="submit" class="m-2 col-md-2 btn btn-md btn-success">Save</button>
                    <button type="reset" class="m-2 col-md-2 col-md-offset-1 btn btn-md btn-warning">Reset</button>
                    <button type="reset" onclick="window.location.href='/trackingtool/'"
                            class="m-2 col-md-2 col-md-offset-1 btn btn-md btn-danger">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    var searchUrl = '';
    $(document).ready(function () {
        $('#id_search').on('change textInput input', searchFieldUpdate);
        $('#searchLink').on('click', goSearch);
    });

    var DUCK_URL = 'https://duckduckgo.com/?q=';
    var GOOGLE_URL = 'https://scholar.google.com/scholar?q=';
    function searchFieldUpdate() {
        var searchTerm = $("#id_search").val();
        if (searchTerm.length > 5) {
            $("#searchLink").removeClass('disabled');
            $("#searchLink").addClass('btn-success');
            $("#searchLink").removeClass('btn-secondary');
        } else {
            if (!$("#searchLink").hasClass('disabled')) {
                $("#searchLink").addClass('disabled');
                $("#searchLink").addClass('btn-secondary');
                $("#searchLink").removeClass('btn-success');
                hidePostSearchFields();
            }
            searchUrl = '';
        }
    }

    function goSearch() {
        var searchTerm = $("#id_search").val();
        if (searchTerm.length > 5) {

            var searchSelection = $("#searchMethodSelect").val();
            if (searchSelection === 'google')
                searchUrl = GOOGLE_URL + searchTerm;
            else if (searchSelection === 'duck')
                searchUrl = DUCK_URL + searchTerm;
            else
                searchUrl = searchTerm;

            showPostSearchFields();
            window.open(searchUrl);
        }
    }

    function hidePostSearchFields() {
        $(".hidden-div").each(function () {
            $(this).hide();
        });
    }

    function showPostSearchFields() {
        $(".hidden-div").each(function () {
            $(this).show();
        });
    }
</script>
{% endblock %}